---
layout: post
status: publish
published: true
title: "*UPDATE* Metawidget meets db4o on Android "
author:
  display_name: Philipp Franke
  login: phil
  email: ph.franke@gmail.com
  url: http://devtopics.de/?page_id=221
author_login: phil
author_email: ph.franke@gmail.com
author_url: http://devtopics.de/?page_id=221
wordpress_id: 235
wordpress_url: http://devtopics.de/?p=235
date: '2013-06-20 15:53:40 +0200'
date_gmt: '2013-06-20 13:53:40 +0200'
categories:
- Android
tags:
- metawidget
- android
- db4o
comments: []
---
<p>Dieses Update bezieht sich auf das kleine Tutorial, welches ich <a href="http:&#47;&#47;devtopics.de&#47;?p=91">hier<&#47;a>&nbsp;beschrieben habe. Der Ausl&ouml;ser f&uuml;r die Anpassung war ein Kommentar von&nbsp;<a href="http:&#47;&#47;kennardconsulting.com&#47;" rel="external nofollow">Richard Kennard<&#47;a>. Er teilte uns mit, dass es eine neue Version von metawidget gibt. Mit dieser Version wurde ein&nbsp;SimpleBindingProcessor f&uuml;r Android hinzugef&uuml;gt. Was das beutet und welche Vorteile uns das bietet, m&ouml;chte ich euch an dem folgenden Code zeigen.</p>
<h3>1. PersonActivity<&#47;h3></p>
<h4>1.1 Vorbereitung<&#47;h4><br />
Ladet euch zuerst die neueste Version von "metawidget" herunter.</p>
<ul>
<li><a title="Download" href="http:&#47;&#47;metawidget.sourceforge.net&#47;download.php"><span style="line-height: 13px;">metawidget 3.4<&#47;span><&#47;a><&#47;li><br />
<&#47;ul><br />
Nach dem Download geht ihr wie <a href="http:&#47;&#47;devtopics.de&#47;?p=91">hier<&#47;a>, unter "Vorbereitung" &nbsp;beschrieben, vor.</p>
<h4><span style="font-size: 1em;">1.2 Laden<&#47;span><&#47;h4><br />
Bisher haben wir mit Hilfe von "setValue(person.getter, "Attributname")" die Informationen aus unserem Objekt "Person" an die von "metawidget" automatisch generierten Eingabefelder &uuml;bergeben.</p>
<pre class="brush: java; gutter: true">        final Bundle bundle = getIntent().getExtras();<br />
		if(bundle != null){<br />
			person = db.ext().getByID(Long.valueOf(bundle.getLong("personID")));<br />
			aMetawidget.setToInspect(person);<br />
			aMetawidget.setValue(person.getFirstName(), "firstName");<br />
			aMetawidget.setValue(person.getLastName(), "lastName");<br />
			aMetawidget.setValue(person.getAge(), "age");<br />
			aMetawidget.setValue(person.getStreetName(), "streetName");<br />
			aMetawidget.setValue(person.getPostalCode(), "postalCode");<br />
			aMetawidget.setValue(person.getCity(), "city");<br />
		} else {<br />
			person = new Person();<br />
			aMetawidget.setToInspect(person);<br />
		}<&#47;pre><br />
Wir hatten mit unserer Person noch recht wenige Attribute. Sollte es sich aber um eine Klasse mit noch mehr Attributen handeln, wird es eine l&auml;stige Angelegenheit. Au&szlig;erdem k&ouml;nnen sich dabei leicht Fehler einschleichen. Mit der Version 3.4 k&ouml;nnen wir darauf verzichten, denn diese Arbeit nimmt uns "metawidget" nun ab.</p>
<pre class="brush: java; gutter: true">        final Bundle bundle = getIntent().getExtras();<br />
		if(bundle != null){<br />
			person = db.ext().getByID(Long.valueOf(bundle.getLong("personID")));<br />
			aMetawidget.setToInspect(person);<br />
		} else {<br />
			person = new Person();<br />
			aMetawidget.setToInspect(person);<br />
		}<&#47;pre><br />
&nbsp;</p>
<h4>1.3 Speichern<&#47;h4><br />
Mit der neuen Version hat sich auch beim Speichern einiges getan.</p>
<pre class="brush: java; gutter: true">        saveButton.setOnClickListener(new OnClickListener() {<br />
			@Override<br />
			public void onClick(View v) {<br />
				if(validateFields()){<br />
					person.setFirstName(aMetawidget.getValue("firstName").toString());<br />
					person.setLastName(aMetawidget.getValue("lastName").toString());<br />
					person.setAge(Integer.parseInt(aMetawidget.getValue("age").toString()));<br />
					person.setStreetName(aMetawidget.getValue("streetName").toString());<br />
					person.setPostalCode(Integer.parseInt(aMetawidget.getValue("postalCode").toString()));<br />
					person.setCity(aMetawidget.getValue("city").toString());<br />
					db.store(person);<br />
					db.commit();<br />
					finish();<br />
				}<br />
			}<br />
		});<&#47;pre><br />
Wir m&uuml;ssen nicht mehr jede einzelne Information aus unserem "AndroidMetawidget" per Hand holen, sondern benutzen in diesem Fall den "WidgetProcessor".</p>
<pre class="brush: java; gutter: true">        saveButton.setOnClickListener(new OnClickListener() {<br />
			@Override<br />
			public void onClick(View v) {<br />
				if(validateFields()){<br />
					aMetawidget.getWidgetProcessor(SimpleBindingProcessor.class).save(aMetawidget);<br />
					db.store(person);<br />
					db.commit();<br />
					finish();<br />
				}<br />
			}<br />
		});<&#47;pre><br />
Auch hier k&ouml;nnt ihr den Vorteil der neuen Version sehen.&nbsp;Wir ersetzen das nervige Aufrufen der Setter unserer Person durch eine einzelne Zeile. Nach dem Aufruf der Methode wird unsere Person mit den Informationen der Eingabefelder bef&uuml;llt. Jetzt &uuml;bergeben wir das Objekt noch in unsere Datenbank und fertig.</p>
<p>Ein besonderer Dank geht an <a href="http:&#47;&#47;kennardconsulting.com&#47;" rel="external nofollow">Richard Kennard<&#47;a>, f&uuml;r die n&uuml;tzlichen Informationen.</p>
<h3>2. Links<&#47;h3></p>
<ul>
<li><a title="db4o" href="http:&#47;&#47;community.versant.com&#47;documentation&#47;reference&#47;db4o-7.12&#47;java&#47;tutorial&#47;">db4o<&#47;a><&#47;li>
<li><a title="metawidget" href="http:&#47;&#47;metawidget.sourceforge.net&#47;documentation.php">metawidget<&#47;a><&#47;li><br />
<&#47;ul></p>
