---
layout: post
status: publish
published: true
title: NodeJS for Realtime web apps
author:
  display_name: daniel
  login: daniel
  email: nemschok@yahoo.de
  url: http://devtopics.de/?page_id=52
author_login: daniel
author_email: nemschok@yahoo.de
author_url: http://devtopics.de/?page_id=52
wordpress_id: 312
wordpress_url: http://devtopics.de/?p=312
date: '2013-07-31 11:29:18 +0200'
date_gmt: '2013-07-31 09:29:18 +0200'
categories:
- Allgemein
- JavaScript
tags:
- javascript
- nodejs
- node
- express
- expressjs
- socket.io
comments: []
---
<p>Hi I am currently investigating in using NodeJS for a real time web app. It seems like a good choice to me for performance reasons and mainly because i can code backend and frontend in the same language. This should lower the learning curve for new developers significantly.</p>
<p>I basically followed this guide to install nodeJS:&nbsp;<a href="http:&#47;&#47;expressjs.com&#47;guide.html">http:&#47;&#47;expressjs.com&#47;guide.html<&#47;a></p>
<p>Here are the steps I had to take for the long way to a running nodeJS server:</p>
<ol>
<li><span style="line-height: 13px;"><a href="http:&#47;&#47;nodejs.org&#47;download" target="_blank">Download<&#47;a>&nbsp;and install nodeJS<&#47;span><&#47;li>
<li>Open a cmd and
<pre class="brush: bash; gutter: true">cd\<br />
md nodetest<br />
cd nodetest<&#47;pre><br />
<&#47;li></p>
<li>This step is only for people behind a company proxy (like me). You'll have to configure npm to use your proxy using the following commands:
<pre class="brush: javascript; gutter: true">npm config set proxy http:&#47;&#47;user:pass@ip:port</p>
<p>npm config set proxy-https https:&#47;&#47;user:pass@ip:port<&#47;pre><br />
<&#47;li></p>
<li>use &nbsp;"npm info socket.io version" and "npm info express version" to find out the latest versions<&#47;li>
<li>Create the following file called package.json in the nodetest folder
<pre class="brush: javascript; gutter: true">{<br />
  "name": "hello-world",<br />
  "description": "hello world test app",<br />
  "version": "0.0.1",<br />
  "private": true,<br />
  "dependencies": {<br />
    "express": "3.3.4",<br />
	"socket.io":"0.9.16"<br />
  }<br />
}<&#47;pre><br />
<&#47;li></p>
<li>Run npm install<&#47;li>
<li>Now you should have the expressJS and socket.io libraries in a folder "node_modules". Next you'll have to create a folder called "public" in your nodetest directory.<&#47;li>
<li>Now copy the contents of &nbsp;&nbsp;C:\nodetest\node_modules\socket.io\node_modules\socket.io-client\dist &nbsp;to&nbsp;C:\nodetest\public\socket.io &nbsp; &nbsp;(obvious step, right?)<&#47;li>
<li>Create server.js in the nodetest directory and sender.html, client.html in the public directory.<&#47;li>
<li>get jquery and jquery ui and copy them into the public directory<&#47;li>
<li>Fill server.js, sender.html, client.html with the code later on the page<&#47;li>
<li>open the htmls in a browser and enjoy. (remember, my code uses port 8080 by default)<&#47;li><br />
<&#47;ol><br />
&nbsp;</p>
<p>server.js:</p>
<pre class="brush: javascript; gutter: true">var express = require(&#039;express&#039;);<br />
var app = express();<br />
var path = require(&#039;path&#039;);</p>
<p>var server = require(&#039;http&#039;).createServer(app);<br />
var io = require(&#039;socket.io&#039;).listen(server);</p>
<p>&#47;&#47;this caused me some nightmares<br />
server.listen(8080);</p>
<p>app.get(&#039;&#47;&#039;, function (req, res) {<br />
  res.sendfile(__dirname + &#039;&#47;index.html&#039;);<br />
});</p>
<p>app.configure(function(){<br />
  app.use(express.static(path.join(__dirname, &#039;public&#039;)));<br />
});</p>
<p>&#47;&#47; note that i force socket.io to fall back on long polling<br />
&#47;&#47;for reliability reasons<br />
io.configure(function () {<br />
io.set("transports", ["xhr-polling"]);<br />
io.set("polling duration", 10);<br />
});</p>
<p>io.sockets.on(&#039;connection&#039;, function (socket) {<br />
  socket.emit(&#039;news&#039;, { hello: &#039;world&#039; });<br />
  &#47;&#47;this is my custom event<br />
  socket.on(&#039;my other event&#039;, function (data) {<br />
    console.log(data);<br />
   &#47;&#47;whenever someone uses sender.html to send something, this line will<br />
   &#47;&#47;broadcast it to everyone else except the original sender<br />
	socket.broadcast.emit(&#039;my other event&#039;,data);<br />
  });<br />
});<&#47;pre><br />
The comment above the server.listen command indicates that I had some problems with expressJs. It seems that when you use app.listen() instead of server.listen() you get a weird problem. I did not take the time to shed light on the cause of the problem but what happens is that you get a HTTP 404 on socket.io 's URL in you browser side scripts.</p>
<p>Socket.io s URL looks something like this:</p>
<p>http:&#47;&#47;IP:8080&#47;socket.io&#47;1&#47;?t=1375254151901</p>
<p>So if you get a HTTP 404 on this, then using server.listen() might be the solution to your problem :-)</p>
<p>Finally here is my very simple sender.html code:</p>
<pre class="brush: html; gutter: true"><html><body></p>
<div id="content"><label>data:<&#47;label>
<div id="data">test<&#47;div><&#47;div><br />
<script src="&#47;socket.io&#47;socket.io.js"><&#47;script></p>
<link href="jquery-ui-1.10.3.custom&#47;css&#47;ui-lightness&#47;jquery-ui-1.10.3.custom.css" rel="stylesheet">
	<script src="jquery&#47;jquery-1.10.2.min.js"><&#47;script><br />
	<script src="jquery-ui-1.10.3.custom&#47;js&#47;jquery-ui-1.10.3.custom.js"><&#47;script></p>
<p><button id="button">Senden<&#47;button><br />
<label>message:<&#47;label><input id="message"><&#47;input><br />
	<script><br />
  var host= window.location.host;<br />
console.log(&#039;hostname:&#039;+host);<br />
  var socket = io.connect(&#039;http:&#47;&#47;&#039;+host,{transports: [&#039;xhr-polling&#039;]});<br />
  &#47;*tell me when you connect<br />
  *the way this works is that your callback gets called whenever<br />
  *the socket receives a &#039;connect&#039; event.<br />
  *&#47;<br />
  socket.on(&#039;connect&#039;, function(client){<br />
  console.log(&#039;connected&#039;);<br />
  });</p>
<p>  &#47;*<br />
  *Ths is taken from one of the examples.<br />
  *&#47;<br />
  socket.on(&#039;news&#039;, function (data) {<br />
    console.log(data);<br />
	 var div = document.getElementById(&#039;data&#039;);<br />
	 div.innerHTML=data;<br />
&#47;&#47;emit sends custom events<br />
    socket.emit(&#039;my other event&#039;, { my: &#039;data&#039; });<br />
  });</p>
<p>  &#47;&#47;use jquery ui to make a button<br />
  $( "#button" ).button().click(function(){</p>
<p>  var text= $(&#039;#message&#039;).val();<br />
  if (text=== undefined || text==="") {text="null";}<br />
  console.log(&#039;sending:&#039;+text);<br />
  &#47;*send whatever text someone entered to the server first<br />
  *The server will take care of broadcasting this for us.<br />
  *&#47;<br />
  socket.emit(&#039;my other event&#039;, { my: text });<br />
  });<br />
<&#47;script></p>
<p><&#47;body><br />
<&#47;html><&#47;pre><br />
And last but not least the simple client.html file. It does not even use jQuery just yet :-)</p>
<pre class="brush: html; gutter: true"><html><body></p>
<div id="content"><label>data:<&#47;label>
<div id="data">test<&#47;div><&#47;div><br />
<script src="&#47;socket.io&#47;socket.io.js"><&#47;script><br />
<script><br />
var host= window.location.host;<br />
console.log(&#039;hostname:&#039;+host);<br />
  var socket = io.connect(&#039;http:&#47;&#47;&#039;+host,{transports: [&#039;xhr-polling&#039;]});<br />
  socket.on(&#039;news&#039;, function (data) {<br />
    console.log(data);<br />
	 var div = document.getElementById(&#039;data&#039;);<br />
	 div.innerHTML=data;</p>
<p>  });<br />
  &#47;&#47;whenever you receive something just display it in a div<br />
  socket.on(&#039;my other event&#039;, function (data) {<br />
  console.log(data);<br />
  var div = document.getElementById(&#039;data&#039;);<br />
	 div.innerHTML=data.my;<br />
  });<br />
<&#47;script></p>
<p><&#47;body><br />
<&#47;html><&#47;pre></p>
